<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Category: {{ category.title() }}</title>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    /* ‚Ä¶ your existing CSS ‚Ä¶ */
  </style>
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <h3>Item Categories</h3>
      <nav>
        <ul>
          <li><a href="{{ url_for('category_items', cat='books') }}" class="item">
                <i class="fas fa-book"></i> Books</a>
          </li>
          <li><a href="{{ url_for('category_items', cat='stationary') }}" class="item">
                <i class="fas fa-pencil-alt"></i> Stationary</a>
          </li>
          <li><a href="{{ url_for('category_items', cat='accessories') }}" class="item">
                <i class="fas fa-key"></i> Accessories</a>
          </li>
          <li><a href="{{ url_for('category_items', cat='others') }}" class="item">
                <i class="fas fa-th-large"></i> Others</a>
          </li>
        </ul>
      </nav>
    </aside>

    <div class="main">
      <div class="search-bar">
        <input type="text" id="search"
               placeholder="Search by description or location..."
               oninput="filterCards()" />
      </div>

      <form method="get" action="{{ url_for('category_items', cat=category) }}">
        <label for="filter_date">Filter by date:</label>
        <input type="date" id="filter_date" name="filter_date"
               min="{{ min_date }}" max="{{ max_date }}"
               value="{{ filter_date or max_date }}">
        <button type="submit">Go</button>
      </form>

      <div class="current-date">
        {% if filter_date %}
          Date: <strong>{{ filter_date }}</strong>
        {% else %}
          Date: <strong>{{ today.strftime('%Y-%m-%d') }}</strong>
        {% endif %}
      </div>

      <div class="card-grid">
        {% for item in items %}
          <div class="card" data-id="{{ item.id }}"
               onclick="openModal({{ item.id }})">
            {% if item.filename %}
              <img src="{{ url_for('static', filename='uploads/' ~ item.filename) }}"
                   alt="{{ item.description }}" />
            {% else %}
              <img src="{{ url_for('static', filename='images/placeholder.png') }}"
                   alt="No image available" />
            {% endif %}
            <div class="card-body">
              <p><strong>{{ item.description }}</strong></p>
              <p>Location: {{ item.location }}</p>
              <p>Date: {{ item.date_found }}</p>
              <p>Found by: {{ item.email }}</p>
            </div>
            <div class="card-footer">
              {% if item.received %}
                <span class="status-indicator status-received">Received</span>
              {% elif item.claimed and item.claimed_by==email %}
                <span class="status-indicator status-claimed">Claimed</span>
              {% elif item.id in user_claims %}
                <span class="status-indicator status-claimed">Pending‚Ä¶</span>
              {% else %}
                <button class="action-btn claim-btn"
                        onclick="event.stopPropagation(); window.location='{{ url_for('claim_report', report_id=item.id) }}'">
                  Claim
                </button>
                <span class="status-indicator status-unclaimed">Unclaimed</span>
              {% endif %}
              {% if 'admin' in roles %}
                <!-- delete button for admins -->
                <button class="action-btn delete-btn"
                        onclick="event.stopPropagation(); if(confirm('Delete this report?')){ window.location='{{ url_for('decide_claim', req_id=0, decision='') }}'; }">
                  üóëÔ∏è Delete
                </button>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>

      <a href="{{ url_for('show_home') }}" class="back-btn">
        &larr; Back to Dashboard
      </a>
    </div>
  </div>

  <!-- Modals‚Ä¶ same as before‚Ä¶ -->

  <!-- Fuse.js for fuzzy search -->
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6"></script>
  <script>
    // embed the items array in JS
    const items = {{ items|tojson }};
    const fuse = new Fuse(items, {
      keys: ['description','location'],
      threshold: 0.3
    });

    function filterCards() {
      const q = document.getElementById('search').value;
      let results = q ? fuse.search(q).map(r=>r.item) : items;
      document.querySelectorAll('.card').forEach(card=>{
        const id = parseInt(card.dataset.id,10);
        card.style.display = results.some(i=>i.id===id) ? '' : 'none';
      });
    }

    // open/close modals‚Ä¶ same as your existing JS
  </script>
</body>
</html>
